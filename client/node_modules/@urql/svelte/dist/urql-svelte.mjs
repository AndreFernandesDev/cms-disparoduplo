import { createRequest as e, Client as t } from "@urql/core";

export * from "@urql/core";

import { make as n, subscribe as r, scan as o, switchMap as i, never as a, concat as u, fromValue as s, map as c } from "wonka";

import { writable as f, derived as l } from "svelte/store";

import { getContext as x, setContext as p } from "svelte";

function _extends() {
  _extends = Object.assign || function(e) {
    for (var t = 1; t < arguments.length; t++) {
      var n = arguments[t];
      for (var r in n) {
        if (Object.prototype.hasOwnProperty.call(n, r)) {
          e[r] = n[r];
        }
      }
    }
    return e;
  };
  return _extends.apply(this, arguments);
}

function fromStore(e) {
  return n((function(t) {
    return e.subscribe(t.next);
  }));
}

var v = {
  fetching: !1,
  stale: !1,
  error: void 0,
  data: void 0,
  extensions: void 0
};

function createPausable(e) {
  return {
    isPaused$: e,
    pause: function pause() {
      e.set(!0);
    },
    resume: function resume() {
      e.set(!1);
    }
  };
}

function queryStore(t) {
  var n = e(t.query, t.variables);
  var x = _extends({}, {
    requestPolicy: t.requestPolicy
  }, t.context);
  var p = t.client.createRequestOperation("query", n, x);
  var d = _extends({}, v, {
    operation: p
  });
  var b = f(d, (function() {
    return m.unsubscribe;
  }));
  var q = f(!!t.pause);
  var m = r((function(e) {
    b.set(e);
  }))(o((function(e, t) {
    return _extends({}, e, t);
  }), d)(i((function(e) {
    if (e) {
      return a;
    }
    return u([ s({
      fetching: !0,
      stale: !1
    }), c((function(e) {
      return {
        fetching: !1,
        stale: !!e.stale,
        data: e.data,
        error: e.error,
        operation: e.operation,
        extensions: e.extensions
      };
    }))(t.client.executeRequestOperation(p)), s({
      fetching: !1
    }) ]);
  }))(fromStore(q))));
  return _extends({}, l(b, (function(e, t) {
    t(e);
  })), createPausable(q));
}

function mutationStore(t, n) {
  var i = e(t.query, t.variables);
  var a = t.client.createRequestOperation("mutation", i, t.context);
  var u = _extends({}, v, {
    operation: a,
    fetching: !0
  });
  var s = f(u);
  var x = r((function(e) {
    s.set(e);
  }))(o((function(e, t) {
    return _extends({}, e, t, {
      data: void 0 !== t.data ? "function" == typeof n ? n(e.data, t.data) : t.data : e.data
    });
  }), u)(c((function(e) {
    return {
      fetching: !1,
      stale: !!e.stale,
      data: e.data,
      error: e.error,
      operation: e.operation,
      extensions: e.extensions
    };
  }))(t.client.executeRequestOperation(a))));
  return l(s, (function(e, t) {
    t(e);
    return x.unsubscribe;
  }));
}

function subscriptionStore(t) {
  var n = e(t.query, t.variables);
  var x = t.client.createRequestOperation("subscription", n, t.context);
  var p = _extends({}, v, {
    operation: x
  });
  var d = f(p, (function() {
    return q.unsubscribe;
  }));
  var b = f(!!t.pause);
  var q = r((function(e) {
    d.set(e);
  }))(o((function(e, t) {
    return _extends({}, e, t);
  }), p)(i((function(e) {
    if (e) {
      return a;
    }
    return u([ s({
      fetching: !0,
      stale: !1
    }), c((function(e) {
      return {
        fetching: !0,
        stale: !!e.stale,
        data: e.data,
        error: e.error,
        operation: e.operation,
        extensions: e.extensions
      };
    }))(t.client.executeRequestOperation(x)), s({
      fetching: !1
    }) ]);
  }))(fromStore(b))));
  return _extends({}, l(d, (function(e, t) {
    t(e);
  })), createPausable(b));
}

function getContextClient() {
  var e = x("$$_urql");
  if ("production" !== process.env.NODE_ENV && !e) {
    throw new Error("No urql Client was found in Svelte context. Did you forget to call setContextClient?");
  }
  return e;
}

function setContextClient(e) {
  p("$$_urql", e);
}

function initContextClient(e) {
  var n = new t(e);
  setContextClient(n);
  return n;
}

export { getContextClient, initContextClient, mutationStore, queryStore, setContextClient, subscriptionStore };
//# sourceMappingURL=urql-svelte.mjs.map
